{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"app\"],{ng4s:function(t,e,n){\"use strict\";n.r(e);n(\"rB9j\"),n(\"UxlC\");var s=n(\"oCYn\"),r=n(\"jE9Z\"),o=n(\"L2JU\"),a=(n(\"fbCW\"),n(\"ToJy\"),n(\"07d7\"),n(\"5s+n\"),n(\"Rm1S\"),{state:{conversations:[],hubUrl:null},getters:{CONVERSATIONS:function(t){return t.conversations.sort((function(t,e){return t.createdAt<e.createdAt}))},MESSAGES:function(t){return function(e){return t.conversations.find((function(t){return t.conversationId===e})).messages}},HUBURL:function(t){return t.hubUrl}},mutations:{SET_CONVERSATIONS:function(t,e){t.conversations=e},SET_MESSAGES:function(t,e){var n=e.conversationId,r=e.payload;s.a.set(t.conversations.find((function(t){return t.conversationId===n})),\"messages\",r)},ADD_MESSAGE:function(t,e){var n=e.conversationId,s=e.payload;t.conversations.find((function(t){return t.conversationId===n})).messages.push(s)},SET_CONVERSATION_LAST_MESSAGE:function(t,e){var n=e.conversationId,s=e.payload,r=t.conversations.find((function(t){return t.conversationId===n}));r.content=s.content,r.createdAt=s.createdAt},SET_HUBURL:function(t,e){return t.hubUrl=e},UPDATE_CONVERSATIONS:function(t,e){var n=t.conversations.find((function(t){return t.conversationId===e.conversation.id}));n.content=e.content,n.createdAt=e.createdAt}},actions:{GET_CONVERSATIONS:function(t){var e=t.commit;return fetch(\"/conversations\").then((function(t){var n=t.headers.get(\"Link\").match(/<([^>]+)>;\\s+rel=(?:mercure|\"[^\"]*mercure[^\"]*\")/)[1];return e(\"SET_HUBURL\",n),t.json()})).then((function(t){e(\"SET_CONVERSATIONS\",t)}))},GET_MESSAGES:function(t,e){var n=t.commit;if(void 0===t.getters.MESSAGES(e))return fetch(\"/messages/\".concat(e)).then((function(t){return t.json()})).then((function(t){n(\"SET_MESSAGES\",{conversationId:e,payload:t})}))},POST_MESSAGE:function(t,e){var n=t.commit,s=e.conversationId,r=e.content,o=new FormData;return o.append(\"content\",r),fetch(\"/messages/\".concat(s),{method:\"POST\",body:o}).then((function(t){return t.json()})).then((function(t){n(\"ADD_MESSAGE\",{conversationId:s,payload:t}),n(\"SET_CONVERSATION_LAST_MESSAGE\",{conversationId:s,payload:t})}))}}});s.a.use(o.a);var i=new o.a.Store({modules:{conversation:a,user:{state:{username:null},getters:{USERNAME:function(t){return t.username}},mutations:{SET_USERNAME:function(t,e){return t.username=e}},actions:{}}}}),c=function(){var t=this.$createElement,e=this._self._c||t;return e(\"div\",{staticClass:\"container py-5 px-4\"},[e(\"div\",{staticClass:\"row rounded-lg overflow-hidden shadow\"},[e(\"Left\"),this._v(\" \"),e(\"router-view\",{key:this.$route.fullPath})],1)])};c._withStripped=!0;var u=function(){var t=this.$createElement,e=this._self._c||t;return e(\"div\",{staticClass:\"col-5 px-0\"},[e(\"div\",{staticClass:\"bg-white\"},[this._m(0),this._v(\" \"),e(\"div\",{staticClass:\"messages-box\"},[e(\"div\",{staticClass:\"list-group rounded-0\"},[this._l(this.CONVERSATIONS,(function(t,n,s){return[e(\"Conversation\",{attrs:{conversation:t}})]}))],2)])])])};u._withStripped=!0;n(\"pNMO\"),n(\"TeQF\"),n(\"QWBl\"),n(\"4mDm\"),n(\"HRxU\"),n(\"eoL8\"),n(\"5DmW\"),n(\"27RR\"),n(\"tkto\"),n(\"PKPk\"),n(\"FZtP\"),n(\"3bBZ\"),n(\"Kz25\");var l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"router-link\",{staticClass:\"list-group-item list-group-item-action rounded-0\",attrs:{to:{name:\"conversation\",params:{id:t.conversation.conversationId}}}},[n(\"div\",{staticClass:\"media\"},[n(\"img\",{staticClass:\"rounded-circle\",attrs:{src:\"https://res.cloudinary.com/mhmd/image/upload/v1564960395/avatar_usae7z.svg\",alt:\"user\",width:\"50\"}}),t._v(\" \"),n(\"div\",{staticClass:\"media-body ml-4\"},[n(\"div\",{staticClass:\"d-flex align-items-center justify-content-between mb-1\"},[n(\"h6\",{staticClass:\"mb-0\"},[t._v(t._s(t.conversation.username))]),n(\"small\",{staticClass:\"small font-weight-bold\"},[t._v(t._s(t.date))])]),t._v(\" \"),n(\"p\",{staticClass:\"font-italic mb-0 text-small\"},[t._v(t._s(t.conversation.content))])])])])};l._withStripped=!0;n(\"DQNa\");var d={props:{conversation:Object},computed:{date:function(){return new Date(this.conversation.createdAt).toLocaleTimeString()}}},p=n(\"KHd+\"),v=Object(p.a)(d,l,[],!1,null,null,null);function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}v.options.__file=\"assets/js/components/Left/Conversation.vue\";var h={components:{Conversation:v.exports},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(o.b)([\"CONVERSATIONS\",\"HUBURL\",\"USERNAME\"])),methods:{updateConversations:function(t){this.$store.commit(\"UPDATE_CONVERSATIONS\",t)}},mounted:function(){var t=this,e=this;this.$store.dispatch(\"GET_CONVERSATIONS\").then((function(){var n=new URL(t.HUBURL);n.searchParams.append(\"topic\",\"/conversations/\".concat(t.USERNAME)),new EventSource(n,{withCredentials:!0}).onmessage=function(t){e.updateConversations(JSON.parse(t.data))}}))}},S=Object(p.a)(h,u,[function(){var t=this.$createElement,e=this._self._c||t;return e(\"div\",{staticClass:\"bg-gray px-4 py-2 bg-light\"},[e(\"p\",{staticClass:\"h5 mb-0 py-1\"},[this._v(\"Recent\")])])}],!1,null,null,null);S.options.__file=\"assets/js/components/Left/Left.vue\";var b=S.exports,_=function(){var t=this.$createElement,e=this._self._c||t;return e(\"div\",{staticClass:\"col-7 px-0\"},[e(\"div\",{ref:\"messagesBody\",staticClass:\"px-4 py-5 chat-box bg-white\"},[this._l(this.MESSAGES,(function(t,n,s){return[e(\"Message\",{attrs:{message:t}})]}))],2),this._v(\" \"),e(\"Input\")],1)};_._withStripped=!0;var g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"div\",{staticClass:\"media w-50 mb-3\",class:{\"ml-auto\":t.message.mine}},[t.message.mine?t._e():n(\"img\",{staticClass:\"rounded-circle\",attrs:{src:\"https://res.cloudinary.com/mhmd/image/upload/v1564960395/avatar_usae7z.svg\",alt:\"user\",width:\"50\"}}),t._v(\" \"),n(\"div\",{staticClass:\"media-body ml-3\"},[n(\"div\",{staticClass:\"rounded py-2 px-3 mb-2\",class:[t.message.mine?\"bg-primary\":\"bg-light\"]},[n(\"p\",{staticClass:\"text-small mb-0\",class:[t.message.mine?\"text-white\":\"text-muted\"]},[t._v(t._s(t.message.content))])]),t._v(\" \"),n(\"p\",{staticClass:\"small text-muted\"},[t._v(t._s(t.date))])])])};g._withStripped=!0;var E={props:{message:Object},computed:{date:function(){return new Date(this.message.createdAt).toLocaleString()}}},O=Object(p.a)(E,g,[],!1,null,null,null);O.options.__file=\"assets/js/components/Right/Message.vue\";var y=O.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"form\",{staticClass:\"bg-light\",attrs:{action:\"#\"}},[n(\"div\",{staticClass:\"input-group\"},[n(\"input\",{directives:[{name:\"model\",rawName:\"v-model\",value:t.content,expression:\"content\"}],staticClass:\"form-control rounded-0 border-0 py-4 bg-light\",attrs:{type:\"text\",placeholder:\"Type a message\",\"aria-describedby\":\"button-addon2\"},domProps:{value:t.content},on:{keyup:function(e){return!e.type.indexOf(\"key\")&&t._k(e.keyCode,\"enter\",13,e.key,\"Enter\")?null:t.sendMessage(e)},input:function(e){e.target.composing||(t.content=e.target.value)}}}),t._v(\" \"),t._m(0)])])};w._withStripped=!0;var C={data:function(){return{content:\"\"}},methods:{sendMessage:function(){var t=this;this.$store.dispatch(\"POST_MESSAGE\",{conversationId:this.$route.params.id,content:this.content}).then((function(){t.content=\"\"}))}}},A=Object(p.a)(C,w,[function(){var t=this.$createElement,e=this._self._c||t;return e(\"div\",{staticClass:\"input-group-append\"},[e(\"button\",{staticClass:\"btn btn-link\",attrs:{id:\"button-addon2\",type:\"submit\"}},[e(\"i\",{staticClass:\"fa fa-paper-plane\"})])])}],!1,null,null,null);function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){R(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}A.options.__file=\"assets/js/components/Right/Input.vue\";var N={data:function(){return{eventSource:null}},components:{Message:y,Input:A.exports},computed:T(T({},Object(o.b)([\"HUBURL\"])),{},{MESSAGES:function(){return this.$store.getters.MESSAGES(this.$route.params.id)}}),methods:{scrollDown:function(){this.$refs.messagesBody.scrollTop=this.$refs.messagesBody.scrollHeight},addMessage:function(t){this.$store.commit(\"ADD_MESSAGE\",{conversationId:this.$route.params.id,payload:t})}},mounted:function(){var t=this,e=this;this.$store.dispatch(\"GET_MESSAGES\",this.$route.params.id).then((function(){if(t.scrollDown(),null===t.eventSource){var n=new URL(t.HUBURL);n.searchParams.append(\"topic\",\"/conversations/\".concat(t.$route.params.id)),t.eventSource=new EventSource(n,{withCredentials:!0}),t.eventSource.onmessage=function(t){e.addMessage(JSON.parse(t.data))}}}))},watch:{MESSAGES:function(t){var e=this;this.$nextTick((function(){e.scrollDown()}))}},beforeDestroy:function(){this.eventSource instanceof EventSource&&this.eventSource.close()}},M=Object(p.a)(N,_,[],!1,null,null,null);M.options.__file=\"assets/js/components/Right/Right.vue\";var P=M.exports,I={components:{Left:b,Right:P}},U=Object(p.a)(I,c,[],!1,null,null,null);U.options.__file=\"assets/js/components/App.vue\";var x=U.exports,D=function(){var t=this.$createElement;return(this._self._c||t)(\"div\",{staticClass:\"col-7 px-0\",staticStyle:{width:\"100%\",\"background-color\":\"white\"}})};D._withStripped=!0;var $={},G=Object(p.a)($,D,[],!1,null,null,null);G.options.__file=\"assets/js/components/Right/Blank.vue\";var L=G.exports;s.a.use(r.a);var k=[{name:\"blank\",path:\"/\",component:L},{name:\"conversation\",path:\"/conversation/:id\",component:P}],B=new r.a({mode:\"abstract\",routes:k});i.commit(\"SET_USERNAME\",document.querySelector(\"#app\").dataset.username),new s.a({store:i,router:B,render:function(t){return t(x)}}).$mount(\"#app\"),B.replace(\"/\")}},[[\"ng4s\",\"runtime\",0]]]);","extractedComments":[]}